#!/usr/bin/env bash
set -euo pipefail

session_name="${1:-devops}"
workspace_dir="${2:-$HOME/work}"

mkdir -p "$workspace_dir"

if tmux has-session -t "$session_name" 2>/dev/null; then
  exec tmux attach -t "$session_name"
fi

tmux new-session -d -s "$session_name" -n shell -c "$workspace_dir"

tmux rename-window -t "$session_name:1" shell
tmux send-keys -t "$session_name:1" 'clear' C-m

tmux new-window -t "$session_name" -n ops -c "$workspace_dir"
tmux split-window -h -t "$session_name:2" -c "$workspace_dir"
tmux split-window -v -t "$session_name:2.1" -c "$workspace_dir"
tmux select-pane -t "$session_name:2.1"

tmux new-window -t "$session_name" -n logs -c "$workspace_dir"
tmux split-window -v -t "$session_name:3" -c "$workspace_dir"
tmux select-pane -t "$session_name:3.1"

tmux new-window -t "$session_name" -n git -c "$workspace_dir"
tmux send-keys -t "$session_name:4" 'git status 2>/dev/null || true' C-m

tmux select-window -t "$session_name:1"
exec tmux attach -t "$session_name"
